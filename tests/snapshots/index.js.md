# Snapshot report for `tests/index.js`

The actual snapshot is saved in `index.js.snap`.

Generated by [AVA](https://avajs.dev).

## action-deprecated-inputs.test.js

> stderr

    ''

> stdout

    `app_id — 'app_id' is deprecated and will be removed in a future version. Use 'app-id' instead.␊
    private_key — 'private_key' is deprecated and will be removed in a future version. Use 'private-key' instead.␊
    skip_token_revoke — 'skip_token_revoke' is deprecated and will be removed in a future version. Use 'skip-token-revoke' instead.`

## main-custom-github-api-url.test.js

> stderr

    ''

> stdout

    `owner and repositories set, creating token for repositories "create-github-app-token" owned by "actions"␊
    ␊
    GET /api/v3/repos/actions/create-github-app-token/installation␊
    ␊
    ␊
    GET /api/v3/repos/actions/create-github-app-token/installation␊
    ␊
    ␊
    POST /api/v3/app/installations/123456/access_tokens␊
    "{\\"repositories\\":[\\"create-github-app-token\\"]}"␊
    ␊
    ␊
    POST /api/v3/app/installations/123456/access_tokens␊
    "{\\"repositories\\":[\\"create-github-app-token\\"]}"␊
    ␊
    ::add-mask::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ␊
    ::set-output name=token::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ␊
    ::set-output name=installation-id::123456␊
    ␊
    ::set-output name=app-slug::github-actions␊
    ::save-state name=token::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ::save-state name=expiresAt::2016-07-11T22:14:10Z`

## main-missing-app-id.test.js

> stderr

    'Input required and not supplied: app-id'

> stdout

    ''

## main-missing-owner.test.js

> stderr

    'GITHUB_REPOSITORY_OWNER missing, must be set to \'<owner>\''

> stdout

    ''

## main-missing-private-key.test.js

> stderr

    'Input required and not supplied: private-key'

> stdout

    ''

## main-missing-repository.test.js

> stderr

    'GITHUB_REPOSITORY missing, must be set to \'<owner>/<repo>\''

> stdout

    ''

## main-private-key-with-escaped-newlines.test.js

> stderr

    ''

> stdout

    `owner and repositories not set, creating token for the current repository ("create-github-app-token")␊
    ␊
    GET /repos/actions/create-github-app-token/installation␊
    ␊
    ␊
    GET /repos/actions/create-github-app-token/installation␊
    ␊
    ␊
    POST /app/installations/123456/access_tokens␊
    "{\\"repositories\\":[\\"create-github-app-token\\"]}"␊
    ␊
    ␊
    POST /app/installations/123456/access_tokens␊
    "{\\"repositories\\":[\\"create-github-app-token\\"]}"␊
    ␊
    ::add-mask::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ␊
    ::set-output name=token::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ␊
    ::set-output name=installation-id::123456␊
    ␊
    ::set-output name=app-slug::github-actions␊
    ::save-state name=token::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ::save-state name=expiresAt::2016-07-11T22:14:10Z`

## main-repo-skew.test.js

> stderr

    `'Issued at' claim ('iat') must be an Integer representing the time that the assertion was issued.␊
    [@octokit/auth-app] GitHub API time and system time are different by 30 seconds. Retrying request with the difference accounted for.`

> stdout

    `owner and repositories set, creating token for repositories "failed-repo" owned by "actions"␊
    ␊
    GET /repos/actions/failed-repo/installation␊
    ␊
    ␊
    GET /repos/actions/failed-repo/installation␊
    ␊
    ␊
    GET /app/installations/123456/access_tokens␊
    ␊
    ␊
    POST /app/installations/123456/access_tokens␊
    "{\\"repositories\\":[\\"failed-repo\\"]}"␊
    ␊
    ␊
    POST /app/installations/123456/access_tokens␊
    "{\\"repositories\\":[\\"failed-repo\\"]}"␊
    ␊
    ::add-mask::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ␊
    ::set-output name=token::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ␊
    ::set-output name=installation-id::123456␊
    ␊
    ::set-output name=app-slug::github-actions␊
    ::save-state name=token::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ::save-state name=expiresAt::2016-07-11T22:14:10Z`

## main-token-get-owner-set-fail-response.test.js

> stderr

    ''

> stdout

    `repositories not set, creating token for all repositories for given owner "smockle"␊
    ␊
    GET /users/smockle/installation␊
    ␊
    Failed to create token for "smockle" (attempt 1): GitHub API not available␊
    ␊
    GET /users/smockle/installation␊
    ␊
    ␊
    GET /app/installations/123456/access_tokens␊
    ␊
    ␊
    POST /app/installations/123456/access_tokens␊
    null␊
    ␊
    ␊
    POST /app/installations/123456/access_tokens␊
    null␊
    ␊
    ::add-mask::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ␊
    ::set-output name=token::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ␊
    ::set-output name=installation-id::123456␊
    ␊
    ::set-output name=app-slug::github-actions␊
    ::save-state name=token::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ::save-state name=expiresAt::2016-07-11T22:14:10Z`

## main-token-get-owner-set-repo-fail-response.test.js

> stderr

    ''

> stdout

    `owner and repositories set, creating token for repositories "failed-repo" owned by "actions"␊
    ␊
    GET /repos/actions/failed-repo/installation␊
    ␊
    RequestError [HttpError]: GitHub API not available␊
        at file:///Users/gregor/code/actions/create-github-app-token/node_modules/@octokit/request/dist-bundle/index.js:106:21␊
        at process.processTicksAndRejections (node:internal/process/task_queues:95:5)␊
        at async hook (file:///Users/gregor/code/actions/create-github-app-token/node_modules/@octokit/auth-app/dist-node/index.js:319:18)␊
        at async getTokenFromRepository (file:///Users/gregor/code/actions/create-github-app-token/lib/main.js:164:20)␊
        at async RetryOperation._fn (file:///Users/gregor/code/actions/create-github-app-token/node_modules/p-retry/index.js:57:20) {␊
      status: 500,␊
      request: {␊
        method: 'GET',␊
        url: 'https://api.github.com/repos/actions/failed-repo/installation',␊
        headers: {␊
          accept: 'application/vnd.github.v3+json',␊
          'user-agent': 'actions/create-github-app-token',␊
          authorization: 'bearer [REDACTED]'␊
        },␊
        request: { hook: [Function: bound hook] AsyncFunction }␊
      },␊
      response: {␊
        url: 'https://api.github.com/repos/actions/failed-repo/installation',␊
        status: 500,␊
        headers: {},␊
        data: 'GitHub API not available'␊
      },␊
      attemptNumber: 1,␊
      retriesLeft: 3␊
    }␊
    Failed to create token for "failed-repo" (attempt 1): GitHub API not available␊
    ␊
    GET /repos/actions/failed-repo/installation␊
    ␊
    ␊
    GET /app/installations/123456/access_tokens␊
    ␊
    ␊
    POST /app/installations/123456/access_tokens␊
    "{\\"repositories\\":[\\"failed-repo\\"]}"␊
    ␊
    ␊
    POST /app/installations/123456/access_tokens␊
    "{\\"repositories\\":[\\"failed-repo\\"]}"␊
    ␊
    ::add-mask::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ␊
    ::set-output name=token::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ␊
    ::set-output name=installation-id::123456␊
    ␊
    ::set-output name=app-slug::github-actions␊
    ::save-state name=token::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ::save-state name=expiresAt::2016-07-11T22:14:10Z`

## main-token-get-owner-set-repo-set-to-many-newline.test.js

> stderr

    ''

> stdout

    `owner and repositories set, creating token for repositories "create-github-app-token,toolkit,checkout" owned by "actions"␊
    ␊
    GET /repos/actions/create-github-app-token/installation␊
    ␊
    ␊
    GET /repos/actions/create-github-app-token/installation␊
    ␊
    ␊
    POST /app/installations/123456/access_tokens␊
    "{\\"repositories\\":[\\"create-github-app-token\\",\\"toolkit\\",\\"checkout\\"]}"␊
    ␊
    ␊
    POST /app/installations/123456/access_tokens␊
    "{\\"repositories\\":[\\"create-github-app-token\\",\\"toolkit\\",\\"checkout\\"]}"␊
    ␊
    ::add-mask::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ␊
    ::set-output name=token::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ␊
    ::set-output name=installation-id::123456␊
    ␊
    ::set-output name=app-slug::github-actions␊
    ::save-state name=token::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ::save-state name=expiresAt::2016-07-11T22:14:10Z`

## main-token-get-owner-set-repo-set-to-many.test.js

> stderr

    ''

> stdout

    `owner and repositories set, creating token for repositories "create-github-app-token,toolkit,checkout" owned by "actions"␊
    ␊
    GET /repos/actions/create-github-app-token/installation␊
    ␊
    ␊
    GET /repos/actions/create-github-app-token/installation␊
    ␊
    ␊
    POST /app/installations/123456/access_tokens␊
    "{\\"repositories\\":[\\"create-github-app-token\\",\\"toolkit\\",\\"checkout\\"]}"␊
    ␊
    ␊
    POST /app/installations/123456/access_tokens␊
    "{\\"repositories\\":[\\"create-github-app-token\\",\\"toolkit\\",\\"checkout\\"]}"␊
    ␊
    ::add-mask::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ␊
    ::set-output name=token::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ␊
    ::set-output name=installation-id::123456␊
    ␊
    ::set-output name=app-slug::github-actions␊
    ::save-state name=token::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ::save-state name=expiresAt::2016-07-11T22:14:10Z`

## main-token-get-owner-set-repo-set-to-one.test.js

> stderr

    ''

> stdout

    `owner and repositories set, creating token for repositories "create-github-app-token" owned by "actions"␊
    ␊
    GET /repos/actions/create-github-app-token/installation␊
    ␊
    ␊
    GET /repos/actions/create-github-app-token/installation␊
    ␊
    ␊
    POST /app/installations/123456/access_tokens␊
    "{\\"repositories\\":[\\"create-github-app-token\\"]}"␊
    ␊
    ␊
    POST /app/installations/123456/access_tokens␊
    "{\\"repositories\\":[\\"create-github-app-token\\"]}"␊
    ␊
    ::add-mask::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ␊
    ::set-output name=token::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ␊
    ::set-output name=installation-id::123456␊
    ␊
    ::set-output name=app-slug::github-actions␊
    ::save-state name=token::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ::save-state name=expiresAt::2016-07-11T22:14:10Z`

## main-token-get-owner-set-repo-unset.test.js

> stderr

    ''

> stdout

    `repositories not set, creating token for all repositories for given owner "actions"␊
    ␊
    GET /users/actions/installation␊
    ␊
    ␊
    GET /app/installations/123456/access_tokens␊
    ␊
    ␊
    POST /app/installations/123456/access_tokens␊
    null␊
    ␊
    ␊
    POST /app/installations/123456/access_tokens␊
    null␊
    ␊
    ::add-mask::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ␊
    ::set-output name=token::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ␊
    ::set-output name=installation-id::123456␊
    ␊
    ::set-output name=app-slug::github-actions␊
    ::save-state name=token::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ::save-state name=expiresAt::2016-07-11T22:14:10Z`

## main-token-get-owner-unset-repo-set.test.js

> stderr

    ''

> stdout

    `owner not set, creating owner for given repositories "create-github-app-token" in current owner ("actions")␊
    ␊
    GET /repos/actions/create-github-app-token/installation␊
    ␊
    ␊
    GET /repos/actions/create-github-app-token/installation␊
    ␊
    ␊
    POST /app/installations/123456/access_tokens␊
    "{\\"repositories\\":[\\"create-github-app-token\\"]}"␊
    ␊
    ␊
    POST /app/installations/123456/access_tokens␊
    "{\\"repositories\\":[\\"create-github-app-token\\"]}"␊
    ␊
    ::add-mask::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ␊
    ::set-output name=token::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ␊
    ::set-output name=installation-id::123456␊
    ␊
    ::set-output name=app-slug::github-actions␊
    ::save-state name=token::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ::save-state name=expiresAt::2016-07-11T22:14:10Z`

## main-token-get-owner-unset-repo-unset.test.js

> stderr

    ''

> stdout

    `owner and repositories not set, creating token for the current repository ("create-github-app-token")␊
    ␊
    GET /repos/actions/create-github-app-token/installation␊
    ␊
    ␊
    GET /repos/actions/create-github-app-token/installation␊
    ␊
    ␊
    POST /app/installations/123456/access_tokens␊
    "{\\"repositories\\":[\\"create-github-app-token\\"]}"␊
    ␊
    ␊
    POST /app/installations/123456/access_tokens␊
    "{\\"repositories\\":[\\"create-github-app-token\\"]}"␊
    ␊
    ::add-mask::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ␊
    ::set-output name=token::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ␊
    ::set-output name=installation-id::123456␊
    ␊
    ::set-output name=app-slug::github-actions␊
    ::save-state name=token::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ::save-state name=expiresAt::2016-07-11T22:14:10Z`

## main-token-permissions-set.test.js

> stderr

    ''

> stdout

    `owner and repositories not set, creating token for the current repository ("create-github-app-token")␊
    ␊
    GET /repos/actions/create-github-app-token/installation␊
    ␊
    ␊
    GET /repos/actions/create-github-app-token/installation␊
    ␊
    ␊
    POST /app/installations/123456/access_tokens␊
    "{\\"repositories\\":[\\"create-github-app-token\\"],\\"permissions\\":{\\"issues\\":\\"write\\",\\"pull_requests\\":\\"read\\"}}"␊
    ␊
    ␊
    POST /app/installations/123456/access_tokens␊
    "{\\"repositories\\":[\\"create-github-app-token\\"],\\"permissions\\":{\\"issues\\":\\"write\\",\\"pull_requests\\":\\"read\\"}}"␊
    ␊
    ::add-mask::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ␊
    ::set-output name=token::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ␊
    ::set-output name=installation-id::123456␊
    ␊
    ::set-output name=app-slug::github-actions␊
    ::save-state name=token::ghs_16C7e42F292c6912E7710c838347Ae178B4a␊
    ::save-state name=expiresAt::2016-07-11T22:14:10Z`

## post-revoke-token-fail-response.test.js

> stderr

    ''

> stdout

    '::warning::Token revocation failed: '

## post-token-expired.test.js

> stderr

    ''

> stdout

    'Token expired, skipping token revocation'

## post-token-set.test.js

> stderr

    ''

> stdout

    'Token revoked'

## post-token-skipped.test.js

> stderr

    ''

> stdout

    'Token revocation was skipped'

## post-token-unset.test.js

> stderr

    ''

> stdout

    'Token is not set'
